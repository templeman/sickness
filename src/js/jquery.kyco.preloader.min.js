/***************************************\

	jquery.kyco.preloader
	=====================

	Version 1.1.4

	Brought to you by
	http://www.kycosoftware.com

	Copyright 2014 Cornelius Weidmann

	Distributed under the GPL

\***************************************/

(function(d){var z={preloadSelector:!0,truePercentage:!0,showInContainer:!1,hideBackground:!1,hideNonImageElements:!1,progressiveReveal:!1,forceSequentialLoad:!1,silentMode:!1,debugMode:!1,useOpacity:!1,hidePercentage:!1,loaderText:"loading images, please wait...",animateDuration:0,fadeOutDuration:100,showImagesBeforeComplete:!0,afterEach:function(){},beforeComplete:function(){},onComplete:function(){}},h={init:function(g){var b=d.extend({},z,g);return this.each(function(){function g(a){a=void 0!== a?a:0;if(-1===G.indexOf(a)){b.debugMode&&console.groupCollapsed("trickle");G.push(a);var c=0,e=0,m=0,f=0;if(b.truePercentage)for(l.forEach(function(a){c+=a.fileSize}),f=0;f<=a;f++)e+=100*(l[f].fileSize/c),f===a-1&&(m=e);else c=q,e=100*((a+1)/c),m=100*(a/c);f=e;v=1E3*(e-m);b.debugMode&&(console.log("updating progressbar to "+f.toFixed(2)+" at "+(v/1E3).toFixed(2)+"s"),console.groupEnd());100===f&&(f=99);A(f,v)}}function w(){b.debugMode&&(console.log((((new Date).getTime()-n)/1E3).toFixed(3)+": preloading image elements..."), console.groupCollapsed("intervals"));b.forceSequentialLoad?function c(b){var m=l[b],f=d("<img>").attr("src",B(m.node));f.load(function(){x(m);++b<l.length&&c(b)}).error(function(){x(m);++b<l.length&&c(b);h(f,m)})}(0):l.forEach(function(b){var e=d("<img>").attr("src",B(b.node));e.load(function(){x(b)}).error(function(){x(b);h(e,b)})})}function h(a,b){b.node.addClass("kyco_preloader_not_found_error")}function x(a){s++;b.truePercentage?(p+=100*(a.fileSize/r),s===q&&(p=100)):p=100*(s/r);A(p);b.progressiveReveal&& t(a.node);b.afterEach.call(a.node)}function A(a,c){void 0===c&&b.debugMode&&console.log((((new Date).getTime()-n)/1E3).toFixed(3)+": "+a.toFixed(2)+"%");c=void 0!==c?c:b.animateDuration;var e=0;y.stop();y.animate({width:a+"%"},{duration:c,easing:"linear",step:function(){e=C.width();D.children("span").html(Math.round(100*(y.width()/e)))},complete:function(){D.children("span").html(Math.round(a));s===q?(b.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-n)/1E3).toFixed(3)+": preloading image elements DONE"), console.groupEnd()),y.delay(100).queue(function(){b.showImagesBeforeComplete?(l.forEach(function(a){t(a.node)}),E.forEach(function(a){t(a)}),b.beforeComplete.call(this),k.animate({opacity:"0"},b.fadeOutDuration,function(){k.remove();b.onComplete.call(this)})):(b.beforeComplete.call(this),k.animate({opacity:"0"},b.fadeOutDuration,function(){l.forEach(function(a){t(a.node)});E.forEach(function(a){t(a)});k.remove();b.onComplete.call(this)}))})):0!==p&&g(s)}})}function B(a){return"none"!==a.css("background-image")? a.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):"none"===a.css("background-image")&&a.attr("data-bg")?a.attr("data-bg").replace(/^url\(["']?/,"").replace(/["']?\)$/,""):a.attr("src")}function t(a){b.useOpacity?a.css("opacity","1"):a.show();a.attr("data-bg")&&a.css("background-image",a.attr("data-bg"))}var u=d(this),z=function(a){function c(a){a=a.children();0<a.length&&a.each(function(){var a=d(this);e.push(a);0<a.children().length&&c(a)})}var e=[];0<a.children().length? (b.preloadSelector&&e.push(a),c(a)):b.preloadSelector&&e.push(a);return e}(u),l=[],E=[],s=0,q=0,p=0,r=0,H=0,v=3E3,G=[],k=d('<div id="kyco_preloader"></div>');b.showInContainer?(k.appendTo(u),u.css("position","relative"),k.css("position","absolute")):k.appendTo("body");d('<div class="kyco_loader_overlay"></div>').appendTo(k);var F=d('<div class="kyco_loader"></div>').appendTo(k),D=b.hidePercentage?d('<div class="kyco_progress_notification">'+b.loaderText+"</div>").appendTo(F):d('<div class="kyco_progress_notification">'+ b.loaderText+' <span class="kyco_progress_percentage">'+p+"</span>%</div>").appendTo(F),C=d('<div class="kyco_progress_bar"></div>').appendTo(F),y=d('<div class="kyco_progress_loaded"></div>').appendTo(C);b.silentMode&&k.hide();b.truePercentage&&A(1,v);if(b.debugMode){var n=(new Date).getTime();console.groupCollapsed("kycoPreload > ",u);console.log((((new Date).getTime()-n)/1E3).toFixed(3)+": scanning DOM for image elements...");console.groupCollapsed("image elements")}z.forEach(function(a){a.is("img")|| "none"!==a.css("background-image")&&-1==a.css("background-image").indexOf("gradient")?(b.preloadSelector&&b.showInContainer&&a===u?b.hideBackground&&a.attr("data-bg",a.css("background-image")).css("background-image","none"):b.useOpacity?a.css("opacity","0"):a.hide(),a={node:a,fileSize:0},b.debugMode&&console.log(a.node),l.push(a),q++):b.hideNonImageElements&&(b.useOpacity?a.css("opacity","0"):a.hide(),E.push(a))});b.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-n)/1E3).toFixed(3)+ ": scanning DOM for image elements DONE"));b.truePercentage?(b.debugMode&&(console.log((((new Date).getTime()-n)/1E3).toFixed(3)+": getting image sizes..."),console.groupCollapsed("image sizes")),l.forEach(function(a){function c(){H++;H===q&&(g(),b.debugMode&&(console.groupEnd(),console.log((((new Date).getTime()-n)/1E3).toFixed(3)+": getting image sizes DONE")),w())}d.ajax({type:"HEAD",url:B(a.node),success:function(e,d,f){a.fileSize=parseInt(f.getResponseHeader("Content-Length"));r+=a.fileSize; b.debugMode&&console.log((a.fileSize/1E3).toFixed(2)+" KB \t"+(r/1E3).toFixed(2)+" KB total");c()},error:function(a,g,f){c();D.addClass("error").html("Not all of your images were preloaded!<br>Loader failed getting image sizes.<br><br>1. Make sure your images exists.<br>2. Make sure your image paths/urls are correct.<br>3. If you load images from a romote domain set truePercentage to false.<br><br><button>Close</button>");C.addClass("error");b.fadeOutDuration=5E5;d("button").click(function(){k.remove()})}})})): (b.debugMode&&console.log((((new Date).getTime()-n)/1E3).toFixed(3)+": getting image sizes SKIPPED"),r=q,g(),w())})}};"forEach"in Array.prototype||(Array.prototype.forEach=function(d,b){for(var h=0,w=this.length;h<w;h++)h in this&&d.call(b,this[h],h,this)});d.fn.kycoPreload=function(g){if(h[g])return h[g].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof g&&g)d.error("Method "+g+" does not exist on jQuery.kycoPreload");else return h.init.apply(this,arguments)}})(jQuery);
